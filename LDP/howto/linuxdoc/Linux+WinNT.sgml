<!doctype linuxdoc system>

<article>


<title>Linux+WindowsNT mini-HOWTO
<author>Miroslav Skoric, <tt/m.skoric@eunet.yu/
<date>v2.0, 28 July 2000
<abstract>
<nidx>windows nt</nidx>
This mini-HOWTO covers some ways on how to install both Linux and Windows
NT on the same computer and how to boot either of them from within LILO menu.
There is also another mini-HOWTO "Linux+NT-Loader" that covers how to boot
either of them from within NT Loader menu.
</abstract>

<sect>Introduction

<p>
Bill Wohler wrote in v1.1 of The Linux+WindowsNT mini-HOWTO:
<p>
<em>"Due to hardware or software problems or user headroom, I pulled my
  hair out for several days trying to get both NT and Linux happily
  settled on my new HP Vectra PC at work."</em>

I could say that was true in my case too, but you <bf/really/ have
a way to make both Linux and Windows NT co-existing on the same
machine and to switch from one of them to another.

<p>
<em>"Under no circumstances run the Disk Administrator from NT 3.51 to
  format partitions.  It asks if it can write a signature "which will
  cause absolutely no harm."  When it did this, it hosed my partition
  table until fixed by steps 3 and 7 below.  Because of these
  problems, I was limited to one FAT NT partition.  Also remember that
  even if you do get the Disk Administrator to work, you'll want at
  least one small FAT partition to use as a staging area for
  exchanging files between Linux and NT until Linux has an NTFS
  filesystem."</em>

Well, NT's Disk Administrator is sufficient tool to check what
situation on your hard disk(s) you have, before and after you used
an utility called Partition Magic by Power Quest. This utility
might be needed to 'shrink' your NT (either NTFS or FAT) partition,
in order to get some free space for your further Linux' partitions.

<em>"I installed Linux first and then NT, but based on my experience, I
  might now be able to install NT first and then Linux."</em>

Of course you all are able to install Windows NT first and after that
Linux. We'll see how to do that and how to use <bf/LILO/ <bf/Li/nux
<bf/Lo/ader to choose which operating system to boot. But, before that
we'll see the procedure that the previous maintainer of this mini-HOWTO
has been using:

<sect1>Linux first, NT after

<p>
 1. Install a minimal Linux (hold off on installing the rest until
  you win the Linux/NT battle).  Do all your disk partitioning in
  Linux, including your NT partition (make it FAT).  I was not
  successful at making more than one NT partition.  I also made it the
  first partition, but I don't know if that is essential or not.

<p>  
  2. Edit /etc/lilo.conf and use boot=/dev/sda (I was not successful
  at installing LILO on the Linux partition--/dev/sda3 in my case) and
  run "lilo".  You'll have to use the editor ae.  You'll live.

<p>
  3. Save the MBR with this: dd if=/dev/sda of=/dev/fd0 bs=512 count=1
  Use a floppy.  Trust me.  Also do this each time you change the disk
  partition table.

<p>
  4. Install NT, part 1.  When it goes to reboot halfway through the
  process you'll boot into Linux.

<p>  
  5. Add NT stanza to /etc/lilo.conf, e.g.:
  
	other=/dev/sda1
	label=NT
	table=/dev/sda

  and run lilo.  If lilo complains about this (I forget the message),
  add the "linear" flag to /etc/lilo.conf near the "compact" keyword.
  Furthermore, if your partition table is screwed up by NT you'll
  either need to use "ignore-table" or follow the directions in Step 7.
  See also "fix-table".  The LILO HOWTO is your friend.

<p>  
  6. Reboot, select NT from LILO, and finish NT install.  You'll need
  the "Boot Disk XU, HP Vectra AIC 7880 Driver A.01.02" floppy to
  install the ethernet drivers and the "XU/VT Drivers and
  Documentation" CD (directory video/disk4 if I recall correctly) to
  install the video drivers for the Matrox MGA Millennium.

<p>  
  7. Back to Linux, run fdisk and ensure you don't get "partition
  doesn't end on cylinder boundary" on your Linux partitions.  You'll
  still have this error on the NT partition though, but this seems to
  be OK.

<p>  
/dev/sda1            1        1      322   329301    6  DOS 16-bit >=32M
Partition 1 does not end on cylinder boundary:
     phys=(321, 39, 9) should be (321, 63, 32)

  Cfdisk reports strangeness, but it seems OK:

                                          Unusable                      0.04*
 /dev/sda1                 Primary        DOS 16-bit >=32Mb           321.59*
                                          Unusable                      0.39*
<p>
  If you do get the cylinder boundary warning on your Linux
  partitions, it is sufficient to use cfdisk to do something innocuous
  like changing the boot sector.

<p>  
  If, however, NT has really screwed you over and cfdisk can't even
  run, complaining that it cannot open /dev/sda, then you'll need to
  take more extreme action.  You'll need that MBR you saved
  previously.  Clear and restore the MBR (but not the signature) with:

<p>
	  dd if=/dev/zero of=/dev/sda bs=512 count=1
	  dd if=/dev/fd0 of=/dev/sda bs=510 count=1

<p>
  8.  Install the rest of Linux.  Easy, huh?

  If you prefer to have NT write the MBR instead of LILO, you may have
  to resort to the following to clear the MBR first:

<itemize>  

<item>dd if=/dev/zero of=/dev/sda bs=446 count=1 (in Linux) or perform
     a low-level format with the SCSI utilities.  I've heard that a
     low-level format of an IDE disk is fatal, so don't do it.

<item>fdisk /mbr (you've obviously already created a DOS boot disk that
     contains fdisk).

<item>delete NT partition and create it again in NT install.

<item>continue with NT install.

</itemize>

<p>
  Epilogue: After first posting this message, I heard from several
  folks that they had no problems with NT's Disk Administrator, and
  were able to install either NT or Linux first without any problems.
  Hopefully, you'll be in this camp, but if not, perhaps this campfire
  story will be of some use.

<p>
  Since the first edition of this mini-HOWTO, others have written
  similar documents as well.  Please be sure to consult them.  If your
  experience differs from any presented, then you should submit your
  own mini-HOWTO or submit a revised version of this document to the
  HOWTO maintainer (reference this sentence) and send a carbon copy to
  me as I don't have the time to maintain this document.  Someone
  should eventually combine all of these documents into a single
  coherent HOWTO.

<p>
  Finally, I'm afraid this document details all I know about this
  subject.  I should point you to an appropriate Linux newsgroup for
  further information.  I use NT about one day a year.  Under duress.

<sect1>NT first, Linux after

<p>
<sect2>If you have one IDE hard disk

<p>
<itemize>

<item>First of all, I would suggest you to install a fresh copy of
      Windows NT 4.0 on your hard disk. I suppose that you already
      made a backup of your important data, so the NT installation
      shouldn't be a problem. During the NT installation, setup is
      not going to ask you where to place NT's boot loader, so it
      would be placed into the MBR (Master Boot Record) of your hard
      disk. But, there is a possibility for a previous content of
      the MBR to remain within the MBR (especially any previous
      Lilo), so I would suggest you (before installation of NT) to
      boot the computer with a DOS floppy diskette having DOS version
      of FDISK. At the prompt a:\  just enter the command: fdisk /mbr  
      and restart the computer again (without that floppy).

<item>After you have successfully installed your NT, you will see that
      it uses the whole hard disk or a specific partition of the hard
      disk (depending on what you decided during the setup process).
      So, it is advisible to 'shrink' the partition where NT resides
      in order to make some free space on the disk. Onto that free space
      you will install your Linux. After you have your NT configured
      and running, you have to boot your computer using a floppy
      diskette with Partition Magic utility by Power Quest. It is a
      graphical tool able to see all partitions on all hard disks you
      have. The best thing is that you can make some changes with your
      partitions but not to destroy your existing data. One of the
      available changes is to make your existing partition(s) smaller,
      so to get some free space on the disk(s) for other purposes.
      Although you are advised to make a backup before you make any
      changes to the partitions, I usually practise to 'shrink' NT's
      partition before I installed anything but NT itself (so, if
      needed, a repetitive re-installation wouldn't be a problem).
      Well, Partition Magic (or any other similar utility you are
      familiar with) will shrink your NT's partition (either NTFS or
      FAT) to a smaller measure and place it to either the beginning
      or to the end of the previous measure. It means that you may
      choose to have your 'shrinked' NT partition at the beginning
      or at the end of your disk (I usually choose NT to be at the
      beginning, so the ending part of the disk will become a 'free
      space'). After the 'shrinkin' is finished, you may re-boot your
      NT in order to check the new situation: you may use Windows
      Explorer or Disk Administrator for that.

<item>So far so good. Next step is to install your Linux. Case you 
      are familiar with RedHat distribution (I hope with other distros
      is the same or similar), you start by putting your installation
      CD in the drive and re-boot the computer). Well, when you are about
      to choose what type of installation it will be (Gnome or KDE 
      Workstation, Custom, etc.) you may choose whatever you planned
      before, but I would suggest to install a Workstation at first.
      This is good because Linux setup will find automatically the
      free space on the (first) hard disk, make all partitions needed
      for Linux, format them properly, make majority of options by
      default so you won't have much pain during the setup (later, if
      you want, you may either add missing components or re-install
      Linux as Custom over the existing linux partitions). Lilo should
      go to the MBR.

<item>After it looks that Linux installation is finished, you are going
      to re-start the computer and there you will only see Lilo
      with one Linux entry to boot (or maybe more than one Linux
      entry, in case your hardware is multi-processor one). But, don't
      panic! Your Windows NT is still there where you had installed it
      before Linux. You should become some familiar with Linux as soon
      as possible, in order to be able to find and edit your new
      /etc/lilo.conf file. When you open this file for the first time,
      you'll see that there is only one (or more) Linux entry. Well,
      you should know the exact position (read: a partition) where
      Windows NT has been installed, so you could add an appropriate
      entry into /etc/lilo.conf file. After you do that, restart Lilo
      and, after the next re-boot, you will have both 'linux' and 'nt'
      entries under Lilo menu. My added NT entry is:

      other=/dev/hda1
      label=nt

</itemize>

<sect2>If you have more than one (SCSI) hard disk 

<p>
<em>Notice: Folks, you see, at my place, one of computers has several
SCSI disks. That's why I put the word 'SCSI' in parentheses. There I
have several SCSI controllers, SCSI CD ROM drive and SCSI Tape drive.
So, it doesn't mean that *you* will be using SCSI parts at all.
You'd rather handle more than one IDE disks, but I hope that install
process shouldn't change too much, if any.
</em>

<p>
<itemize>

<item>First of all, I would suggest you to install a fresh copy of
      Windows NT 4.0 on your <bf/first/ hard disk. I suppose that you already
      made a backup of your important data, so the NT installation
      shouldn't be a problem. You can easily copy your data on your 
      second hard disk or so. During the NT installation, setup is
      not going to ask you where to place NT's boot loader, so it
      would be placed into the MBR (Master Boot Record) of your <bf/first/ hard
      disk. But, there is a possibility for a previous content of
      the MBR to remain within the MBR (especially any previous
      Lilo), so I would suggest you (before installation of NT) to
      boot the computer with a DOS floppy diskette having DOS version
      of FDISK. At the prompt a:\  just enter the command: fdisk /mbr  
      and restart the computer again (without that floppy). If you
      want to be sure about your machine is 'clean', you may also
      delete any existing partition(s) on your <em>other</em> disks, during the
      Windows NT Setup <bf/in case you have *not* made any backup on
      other disks/. 

<item>After you have successfully installed your NT, you will see that
      it uses the whole hard disk or a specific partition of the hard
      disk (depending on what you decided during the setup process).
      So, it is advisible to 'shrink' the partition where NT resides
      in order to make some free space on the disk. Onto that free space
      you will install your Linux. Well, you may also think of using
      some other disk(s) you have for Linux (so did I). That case, you
      would start your linux installation and try to use, for example,
      /dev/sdb (or sdc, or sdd, or else in case of SCSI system) or
      /dev/hdb (or hdc, or hdd, or else in case of IDE system). Looks
      like Linux installation accepts whatever you choose, but somehow
      after all was finished when I did that, LILO was no able to
      do anything. Actually, it always stopped after 'LI' so it was
      possible to start Linux at all. Finally, after pulling my hair
      out, I decided to make it all on the  <bf/first/ disk. So, after
      I had NT configured and running, I had to boot my computer using
      a floppy diskette with Partition Magic utility by Power Quest.
      It is a graphical tool able to see all partitions on all hard disks you
      have. The best thing is that you can make some changes with your
      partitions but not to destroy your existing data. One of the
      available changes is to make your existing partition(s) smaller,
      so to get some free space on the disk(s) for other purposes.
      Although you are advised to make a backup before you make any
      changes to the partitions, I usually practise to 'shrink' NT's
      partition before I installed anything but NT itself (so, if
      needed, a repetitive re-installation wouldn't be a problem).
      Well, Partition Magic (or any other similar utility you are
      familiar with) will shrink your NT's partition (either NTFS or
      FAT) to a smaller measure and place it to either the beginning
      or to the end of the previous measure. It means that you may
      choose to have your 'shrinked' NT partition at the beginning
      or at the end of your disk (I usually choose NT to be at the
      beginning, so the ending part of the disk will become a 'free
      space'). After the 'shrinkin' is finished, you may re-boot your
      NT in order to check the new situation: you may use Windows
      Explorer or Disk Administrator for that. You will note that
      NT 'sees' all other disks you have in your machine (either
      partitioned or as 'free space' areas).

<item>So far so good. Next step is to install your Linux. Case you 
      are familiar with RedHat distribution (I hope with other distros
      is the same or similar), you start by putting your installation
      CD in the drive and re-boot the computer). Well, when you are about
      to choose what type of installation it will be (Gnome or KDE 
      Workstation, Custom, etc.) you may choose whatever you planned
      before, but I would suggest to install a Workstation at first.
      This is good because Linux setup will find automatically the
      free space on the <bf/first/ hard disk, make all partitions needed
      for Linux, format them properly, make majority of options by
      default so you won't have much pain during the setup (later, if
      you want, you may either add missing components or re-install
      Linux as Custom over the existing linux partitions). Lilo should
      go to the MBR of your <bf/first/ disk.

<item>After it looks that Linux installation is finished, you are going
      to re-start the computer and there you will only see Lilo
      with one Linux entry to boot (or maybe more than one Linux
      entry, in case your hardware is multi-processor one). But, don't
      panic! Your Windows NT is still there where you had installed it
      before Linux. You should become some familiar with Linux as soon
      as possible, in order to be able to find and edit your new
      /etc/lilo.conf file. When you open this file for the first time,
      you'll see that there is only one (or more) Linux entry. Well,
      you should know the exact position (read: a partition) where
      Windows NT has been installed, so you could add an appropriate
      entry into /etc/lilo.conf file. After you do that, restart Lilo
      and, after the next re-boot, you will have both 'linux' and 'nt'
      entries under Lilo menu. My added NT entry is:

      other=/dev/sda1
      label=nt

</itemize>
 
<sect1>Copyright
<p>
<em>Copyright is a source of much and continuous debate on the
LDP mailing list. For more in depth information please consult
the Manifesto at the </em>
<url url="http://www.LinuxDoc.org/"
    name="LinuxDoc">
site.
<em>
The purpose of having a license is to allow appropriate distribution.
You can use any license that meets the Manifesto.
What follows is a boilerplate licence.
</em>
<p>
Copyright (c) 2000 by Miroslav Skoric.
<P>
Please freely copy and distribute (sell or give away) this document in
any format.  It's requested that corrections and/or comments be fowarded
to the document maintainer. You may create a derivative work and distribute
it provided that you:

<itemize>
<item>
Send your derivative work (in the most suitable format such as
sgml) to the LDP (Linux Documentation Project) or the like for posting
on the Internet.  If not the LDP, then let the LDP know where it is
available.
<item>
License the derivative work with this same license or use GPL.
Include a copyright notice and at least a pointer to the license used.
<item>
Give due credit to previous authors and major contributors.
</itemize>

<P>
If you're considering making a derived work other than a translation,
it's requested that you discuss your plans with the current maintainer.



<sect1>Disclaimer
<p>

Use the information in this document at your own risk. I disavow any
potential liability for the contents of this document. Use of the
concepts, examples, and/or other content of this document is entirely
at your own risk.

All copyrights are owned by their owners, unless specifically noted
otherwise.  Use of a term in this document should not be regarded as
affecting the validity of any trademark or service mark.

Naming of particular products or brands should not be seen as endorsements.

You are strongly recommended to take a backup of your system before
major installation and backups at regular intervals.


<sect1>News
<p>
<nidx>(your index root)!news on</nidx> <!-- Note to LDP: I still don't understand fot is the purpose of this indexing, so I'll let you to index whatever you think it is suitable, both here and on the other parts of text. Misko -->

This is the second release featuring more samples and an improved structure.
Beside that, this version of Linux+WinNT mini-HOWTO is going to offer you
another procedure to install both Linux and NT on your computer. And doing
that on both IDE and SCSI disks.

<em>This mini-HOWTO would be improved from time to time. If you think
that the HOWTO on your Linux installation CD is some out-of-date, you
may check for newest release on the Internet. It could be found within
the main <url url="http://www.linuxdoc.org/"
    name="Linux Documentation Project">
homepage.
</em>

<sect1>Credits
<p>
<em>This version of Linux+WinNT mini-HOWTO is based on:</em>

<tscreen><verb>
The Linux+WindowsNT mini-HOWTO
by Bill Wohler, wohler@newt.com
v1.1, 19 February 1997
</verb></tscreen>


Any comments or suggestions can be mailed to my email address:
<htmlurl url="mailto:m.skoric@eunet.yu/"
    name="m.skoric@eunet.yu">.

<sect>Further Information
<sect1>HOWTO
<p>
<nidx>disk!information resources!HOWTOs</nidx>
These are intended as the primary starting points to
get the background information as well as show you how to solve
a specific problem.
Some relevant HOWTOs are <tt/Bootdisk/, <tt/Installation/,  <tt/SCSI/ and <tt/UMSDOS/.
The main site for these is the
<url url="http://metalab.unc.edu/LDP/"
    name="LDP archive">
at Metalab (formerly known as Sunsite).

<sect1>Mini-HOWTO
<p>
<nidx>disk!information resources!mini-HOWTOs</nidx>
These are the smaller free text relatives to the HOWTOs.
Some relevant mini-HOWTOs are
<tt/Backup-With-MSDOS/, <tt/Diskless/, <tt/LILO/, <tt/Large Disk/,
<tt/Linux+DOS+Win95+OS2/, <tt/Linux+OS2+DOS/, <tt/Linux+Win95/,
<tt/Linux+WinNT/,<tt/NFS-Root/, <tt/Win95+Win+Linux/, <tt/ZIP Drive/ .
You can find these at the same place as the HOWTOs, usually in a sub directory
called <tt/mini/. Note that these are scheduled to be converted into SGML and
become proper HOWTOs in the near future.

<sect1>Local Resources
<p>
<nidx>disk!information resources!local</nidx>
In most distributions of Linux there is a document directory installed,
have a look in the
<htmlurl url="file:///usr/doc"
    name="/usr/doc"> directory.
where most packages store their main documentation and README files etc.
Also you will here find the HOWTO archive (
<htmlurl url="file:///usr/doc/HOWTO"
    name="/usr/doc/HOWTO">)
of ready formatted HOWTOs
and also the mini-HOWTO archive (
<url url="file:///usr/doc/HOWTO/mini"
    name="/usr/doc/HOWTO/mini">)
of plain text documents.

Many of the configuration files mentioned earlier can be found in the
<htmlurl url="file:///etc"
    name="/etc">
directory. In particular you will want to work with the
<htmlurl url="file:///etc/fstab"
    name="/etc/fstab">
file that sets up the mounting of partitions
and possibly also
<htmlurl url="file:///etc/mdtab"
    name="/etc/mdtab">
file that is used for the <tt/md/ system to set up RAID.

The kernel source in
<url url="file:///usr/src/linux"
    name="/usr/src/linux">
is, of course, the ultimate documentation. In other
words, <em>use the source, Luke</em>.
It should also be pointed out that the kernel comes not only with
source code which is even commented (well, partially at least)
but also an informative
<url url="file:///usr/src/linux/Documentation"
    name="documentation directory">.
If you are about to ask any questions about the kernel you should
read this first, it will save you and many others a lot of time
and possibly embarrassment.

Also have a look in your system log file (
<htmlurl url="file:///var/log/messages"
    name="/var/log/messages">)
to see what is going on and in particular how the booting went if
too much scrolled off your screen. Using <tt>tail -f /var/log/messages</tt>
in a separate window or screen will give you a continuous update of what is
going on in your system.

You can also take advantage of the 
<htmlurl url="file:///proc"
    name="/proc">
file system that is a window into the inner workings of your system.
Use <tt/cat/ rather than <tt/more/ to view the files as they are 
reported as being zero length. Reports are that <tt/less/ works well here.


<sect1>Web Pages
<p>
<nidx>disk!information resources!WWW</nidx>
<nidx>disk!information resources!web pages</nidx>
There is a huge number of informative web pages out there and by their very
nature they change quickly so don't be too surprised if these links become
quickly outdated.

A good starting point is of course the
<url url="http://www.linuxdoc.org/"
    name="Linux Documentation Project"> home page,
an information central for documentation, project pages and much, much more.

Please let me know if you have any other leads that can be of interest.


<sect>Getting Help
<p>
<nidx>(your index root)!assistance, obtaining</nidx>

In the end you might find yourself unable to solve your problems and need
help from someone else. The most efficient way is either to ask someone
local or in your nearest Linux user group, search the web for the nearest
one.

Another possibility is to ask on Usenet News in one of the many, many
newsgroups available. The problem is that these have such a high
volume and noise (called low signal-to-noise ratio) that your question
can easily fall through unanswered.

No matter where you ask it is important to ask well or you will not be
taken seriously. Saying just <it/my disk does not work/ is not going
to help you and instead the noise level is increased even further and if
you are lucky someone will ask you to clarify.

Instead describe your problems in some detail that
will enable people to help you. The problem could lie somewhere you did
not expect. Therefore you are advised to list up the following information
on your system:

<descrip>
<tag/Hardware/
<itemize>
<item>Processor
<item>DMA
<item>IRQ
<item>Chip set (LX, BX etc)
<item>Bus (ISA, VESA, PCI etc)
<item>Expansion cards used (Disk controllers, video, IO etc)
</itemize>

<tag/Software/
<itemize>
<item>BIOS (On motherboard and possibly SCSI host adapters)
<item>LILO, if used
<item>Linux kernel version as well as possible modifications and patches
<item>Kernel parameters, if any
<item>Software that shows the error (with version number or date)
</itemize>

<tag/Peripherals/
<itemize>
<item>Type of disk drives with manufacturer name, version and type
<item>Other relevant peripherals connected to the same busses
</itemize>

</descrip>

Remember that booting text is logged to <tt>/var/log/messages</tt> which can
answer most of the questions above. Obviously if the drives fail you might not
be able to get  the log saved to disk but you can at least scroll back up the
screen using the <tt/SHIFT/ and <tt/PAGE UP/ keys. It may also be useful to
include part of this in your request for help but do not go overboard, keep
it <em/brief/ as a complete log file dumped to Usenet News is more than a
little annoying.



</article>

